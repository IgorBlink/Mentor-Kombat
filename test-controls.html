<!DOCTYPE html>
<html>
<head>
    <title>Test Controls - Multiplayer</title>
    <script src="mk.js/game/src/movement.js"></script>
    <script src="mk.js/game/src/mk.js"></script>
    <style>
        body { 
            margin: 20px; 
            font-family: Arial, sans-serif; 
            background: #1a1a1a;
            color: white;
        }
        #arena { 
            border: 2px solid #fbbf24; 
            margin: 10px 0; 
            background: black;
        }
        .controls { 
            margin: 10px 0; 
            display: flex;
            gap: 20px;
        }
        .control-panel {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #666;
        }
        .player1 { border-left: 4px solid #10b981; }
        .player2 { border-left: 4px solid #3b82f6; }
        button { 
            margin: 5px; 
            padding: 10px 15px; 
            background: #fbbf24;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { background: #f59e0b; }
        .info { 
            margin: 10px 0; 
            padding: 15px; 
            background: #374151; 
            border-radius: 8px;
        }
        .layout-button {
            background: #ef4444;
            color: white;
        }
        .layout-button:hover { background: #dc2626; }
        h3 { color: #fbbf24; margin-top: 0; }
        .key { 
            background: #4b5563; 
            padding: 2px 6px; 
            border-radius: 3px; 
            font-family: monospace;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>üéÆ Nfactorial Mentor Combat - Controls Test</h1>
    
    <div class="info">
        <h3>üéØ –¶–µ–ª—å —Ç–µ—Å—Ç–∞:</h3>
        <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–≤—É–º—è –∏–≥—Ä–æ–∫–∞–º–∏ –Ω–∞ –æ–¥–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª–∞–≤–∏—à–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ–π—Ü–∞–º–∏!</p>
    </div>

    <div class="controls">
        <button onclick="startGame('standard')">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Ä–∞—Å–∫–ª–∞–¥–∫–æ–π</button>
        <button onclick="startGame('alternative')" class="layout-button">üîÑ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–π —Ä–∞—Å–∫–ª–∞–¥–∫–æ–π</button>
        <button onclick="stopGame()">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
    </div>

    <div class="controls">
        <div class="control-panel player1">
            <h3>üü¢ –ò–≥—Ä–æ–∫ 1 (Sub-Zero)</h3>
            <div><strong>–î–≤–∏–∂–µ–Ω–∏–µ:</strong> <span class="key">W</span><span class="key">A</span><span class="key">S</span><span class="key">D</span></div>
            <div><strong>–ë–ª–æ–∫:</strong> <span class="key">Shift</span></div>
            <div><strong>–£–¥–∞—Ä—ã:</strong> <span class="key">Q</span> (—Å–∏–ª—å–Ω—ã–π), <span class="key">E</span> (—Å–ª–∞–±—ã–π)</div>
            <div><strong>–ö–∏–∫–∏:</strong> <span class="key">Z</span> (—Å–ª–∞–±—ã–π), <span class="key">X</span> (—Å–∏–ª—å–Ω—ã–π)</div>
        </div>

        <div class="control-panel player2" id="player2-controls">
            <h3>üîµ –ò–≥—Ä–æ–∫ 2 (Kano)</h3>
            <div id="p2-movement"><strong>–î–≤–∏–∂–µ–Ω–∏–µ:</strong> <span class="key">‚Üë</span><span class="key">‚Üê</span><span class="key">‚Üì</span><span class="key">‚Üí</span></div>
            <div id="p2-block"><strong>–ë–ª–æ–∫:</strong> <span class="key">/</span></div>
            <div id="p2-punches"><strong>–£–¥–∞—Ä—ã:</strong> <span class="key">O</span> (—Å–∏–ª—å–Ω—ã–π), <span class="key">P</span> (—Å–ª–∞–±—ã–π)</div>
            <div id="p2-kicks"><strong>–ö–∏–∫–∏:</strong> <span class="key">,</span> (—Å–ª–∞–±—ã–π), <span class="key">.</span> (—Å–∏–ª—å–Ω—ã–π)</div>
        </div>
    </div>

    <div id="arena"></div>
    <div id="status"></div>

    <script>
        let currentGame = null;
        let currentLayout = 'standard';

        function log(message) {
            document.getElementById('status').innerHTML += '<div style="color: #10b981; margin: 2px 0;">' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
        }

        function updatePlayer2Controls(layout) {
            const movement = document.getElementById('p2-movement');
            const block = document.getElementById('p2-block');
            const punches = document.getElementById('p2-punches');
            const kicks = document.getElementById('p2-kicks');

            if (layout === 'alternative') {
                movement.innerHTML = '<strong>–î–≤–∏–∂–µ–Ω–∏–µ:</strong> <span class="key">I</span><span class="key">J</span><span class="key">K</span><span class="key">L</span>';
                block.innerHTML = '<strong>–ë–ª–æ–∫:</strong> <span class="key">Enter</span>';
                punches.innerHTML = '<strong>–£–¥–∞—Ä—ã:</strong> <span class="key">U</span> (—Å–∏–ª—å–Ω—ã–π), <span class="key">O</span> (—Å–ª–∞–±—ã–π)';
                kicks.innerHTML = '<strong>–ö–∏–∫–∏:</strong> <span class="key">N</span> (—Å–ª–∞–±—ã–π), <span class="key">M</span> (—Å–∏–ª—å–Ω—ã–π)';
            } else {
                movement.innerHTML = '<strong>–î–≤–∏–∂–µ–Ω–∏–µ:</strong> <span class="key">‚Üë</span><span class="key">‚Üê</span><span class="key">‚Üì</span><span class="key">‚Üí</span>';
                block.innerHTML = '<strong>–ë–ª–æ–∫:</strong> <span class="key">/</span>';
                punches.innerHTML = '<strong>–£–¥–∞—Ä—ã:</strong> <span class="key">O</span> (—Å–∏–ª—å–Ω—ã–π), <span class="key">P</span> (—Å–ª–∞–±—ã–π)';
                kicks.innerHTML = '<strong>–ö–∏–∫–∏:</strong> <span class="key">,</span> (—Å–ª–∞–±—ã–π), <span class="key">.</span> (—Å–∏–ª—å–Ω—ã–π)';
            }
        }

        function stopGame() {
            if (currentGame) {
                try {
                    document.getElementById('arena').innerHTML = '';
                    currentGame = null;
                    log('‚úÖ –ò–≥—Ä–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
                } catch (e) {
                    log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ: ' + e.message);
                }
            }
        }

        function startGame(layout) {
            log('üéÆ –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã —Å —Ä–∞—Å–∫–ª–∞–¥–∫–æ–π: ' + (layout === 'alternative' ? '–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è' : '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è'));
            
            currentLayout = layout;
            updatePlayer2Controls(layout);
            
            stopGame();
            document.getElementById('status').innerHTML = '';
            
            try {
                if (typeof window.mk === 'undefined') {
                    log('‚ùå mk.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                    return;
                }

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞—Å–∫–ª–∞–¥–∫—É
                if (window.mk.controllers && window.mk.controllers.setKeyLayout) {
                    window.mk.controllers.setKeyLayout(layout);
                    log('üîß –†–∞—Å–∫–ª–∞–¥–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: ' + layout);
                }

                const options = {
                    arena: {
                        container: document.getElementById('arena'),
                        arena: window.mk.arenas.types.THRONE_ROOM,
                        width: 800,
                        height: 400
                    },
                    fighters: [
                        { name: 'Subzero' },
                        { name: 'Kano' }
                    ],
                    gameType: 'multiplayer' // –í–∞–∂–Ω–æ: –∏—Å–ø–æ–ª—å–∑—É–µ–º multiplayer!
                };

                log('üöÄ –°–æ–∑–¥–∞–Ω–∏–µ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä –∏–≥—Ä—ã...');
                const gamePromise = window.mk.start(options);
                
                if (gamePromise && gamePromise.ready) {
                    gamePromise.ready(() => {
                        log('üéâ –ò–≥—Ä–∞ –≥–æ—Ç–æ–≤–∞! –ù–∞—á–∏–Ω–∞–π—Ç–µ –±–æ–π!');
                        log('üí° Player 1 (üü¢): WASD + Q/E/Z/X + Shift');
                        if (layout === 'alternative') {
                            log('üí° Player 2 (üîµ): IJKL + U/O/N/M + Enter');
                        } else {
                            log('üí° Player 2 (üîµ): –°—Ç—Ä–µ–ª–∫–∏ + O/P/,/. + /');
                        }
                        currentGame = gamePromise;
                    });
                } else {
                    log('‚ö†Ô∏è –ù–µ—Ç ready callback');
                    currentGame = gamePromise;
                }

            } catch (e) {
                log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: ' + e.message);
                console.error('–ü–æ–ª–Ω–∞—è –æ—à–∏–±–∫–∞:', e);
            }
        }

        window.onload = function() {
            log('üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            log('üîç mk.js –¥–æ—Å—Ç—É–ø–µ–Ω: ' + (typeof window.mk !== 'undefined'));
            
            if (window.mk && window.mk.arenas && window.mk.arenas.types) {
                log('‚úÖ –ê—Ä–µ–Ω—ã –¥–æ—Å—Ç—É–ø–Ω—ã: ' + Object.keys(window.mk.arenas.types).join(', '));
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Ä–∞—Å–∫–ª–∞–¥–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            updatePlayer2Controls('standard');
        };
    </script>
</body>
</html> 