<!DOCTYPE html>
<html>
<head>
    <title>MK.js Test</title>
    <style>
        body {
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        
        #container {
            border: 2px solid #ffd700;
            width: 800px;
            height: 400px;
            margin: 20px auto;
            background: #111;
        }
        
        .info {
            text-align: center;
            margin: 20px;
        }
        
        button {
            background: #ff0000;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .log {
            background: #222;
            border: 1px solid #555;
            padding: 10px;
            margin: 10px;
            font-family: monospace;
            height: 200px;
            overflow-y: scroll;
        }
    </style>
</head>
<body>
    <div class="info">
        <h1>MK.js Simple Test</h1>
        <button onclick="startTest()">Start Test</button>
        <button onclick="clearLog()">Clear Log</button>
        <button onclick="checkContainer()">Check Container</button>
    </div>
    
    <div id="container"></div>
    
    <div class="log" id="log"></div>
    
    <script src="/mk.js/game/src/movement.js"></script>
    <script src="/mk.js/game/src/mk.js"></script>
    
    <script>
        console.log('=== MK.js Test Starting ===');
        
        function log(message) {
            console.log(message);
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += message + '<br>';
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        function checkContainer() {
            const container = document.getElementById('container');
            log('Container children: ' + container.children.length);
            log('Container HTML: ' + container.innerHTML.substring(0, 100));
        }
        
        let gameStarted = false;
        
        function startTest() {
            if (gameStarted) {
                log('❌ Test already started');
                return;
            }
            
            gameStarted = true;
            log('🎮 Starting MK.js test...');
            
            if (typeof mk === 'undefined') {
                log('❌ mk.js not loaded!');
                return;
            }
            
            log('✅ mk.js loaded');
            log('Arena types: ' + Object.keys(mk.arenas.types).join(', '));
            log('Fighter count: ' + Object.keys(mk.fighters).length);
            
            const container = document.getElementById('container');
            container.innerHTML = ''; // Clear container
            
            const options = {
                arena: {
                    container: container,
                    arena: mk.arenas.types.THRONE_ROOM
                },
                fighters: [
                    { name: 'Subzero' },
                    { name: 'Kano' }
                ],
                gameType: 'basic'
            };
            
            log('🚀 Starting mk.start() with options: ' + JSON.stringify(options, null, 2));
            
            try {
                const gamePromise = mk.start(options);
                log('📋 mk.start() returned: ' + typeof gamePromise);
                log('Promise has ready method: ' + (typeof gamePromise.ready === 'function'));
                
                if (typeof gamePromise.ready === 'function') {
                    gamePromise.ready(() => {
                        log('🎉 GAME READY CALLBACK CALLED!');
                        checkContainer();
                    });
                    
                    // Check every second for 10 seconds
                    let checkCount = 0;
                    const checker = setInterval(() => {
                        checkCount++;
                        log(`⏰ Check ${checkCount}: Container children = ${container.children.length}`);
                        
                        if (checkCount >= 10) {
                            clearInterval(checker);
                            log('⚠️ Stopped checking after 10 seconds');
                            if (container.children.length > 0) {
                                log('🔧 Container has content but ready may not have been called');
                            }
                        }
                    }, 1000);
                } else {
                    log('❌ gamePromise.ready is not a function');
                }
                
            } catch (error) {
                log('❌ Error starting game: ' + error.message);
            }
        }
        
        // Auto-start after page loads
        window.addEventListener('load', () => {
            log('📄 Page loaded, mk available: ' + (typeof mk !== 'undefined'));
            setTimeout(() => {
                log('🚀 Auto-starting test in 1 second...');
                setTimeout(startTest, 1000);
            }, 100);
        });
    </script>
</body>
</html> 