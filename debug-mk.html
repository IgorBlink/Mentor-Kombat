<!DOCTYPE html>
<html>
<head>
    <title>Debug MK.js</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #333;
            color: white;
            font-family: Arial, sans-serif;
        }
        #arena {
            border: 2px solid yellow;
            width: 640px;
            height: 320px;
            background: black;
            margin: 20px auto;
        }
        .log {
            background: #222;
            padding: 10px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>MK.js Debug Test</h1>
    <div id="arena"></div>
    <div class="log" id="log"></div>
    
    <script>
        function log(message) {
            const logEl = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logEl.innerHTML += `[${time}] ${message}<br>`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(message);
        }
        
        log('Starting debug test...');
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º movement.js
        const movement = document.createElement('script');
        movement.src = 'mk.js/game/src/movement.js';
        movement.onload = () => {
            log('‚úÖ movement.js loaded');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º mk.js
            const mk = document.createElement('script');
            mk.src = 'mk.js/game/src/mk.js';
            mk.onload = () => {
                log('‚úÖ mk.js loaded');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å mk –æ–±—ä–µ–∫—Ç–∞
                setTimeout(() => {
                    if (typeof window.mk !== 'undefined') {
                        log('‚úÖ window.mk is available');
                        log('mk object type: ' + typeof window.mk);
                        
                        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø—É—Ç–∏ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º
                        if (window.mk.config) {
                            log('Original image path: ' + window.mk.config.IMAGES);
                            window.mk.config.IMAGES = 'mk.js/game/images/';
                            log('Updated image path: ' + window.mk.config.IMAGES);
                        }
                        
                        if (window.mk.arenas) {
                            log('‚úÖ mk.arenas is available');
                            
                            if (window.mk.arenas.types) {
                                log('‚úÖ mk.arenas.types is available');
                                log('Available arenas: ' + Object.keys(window.mk.arenas.types).join(', '));
                                
                                // –ü—Ä–æ–±—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É
                                try {
                                    const arenaEl = document.getElementById('arena');
                                    log('üöÄ Starting game...');
                                    
                                    const options = {
                                        arena: {
                                            container: arenaEl,
                                            arena: window.mk.arenas.types.THRONE_ROOM
                                        },
                                        fighters: [
                                            { name: 'Subzero' },
                                            { name: 'Kano' }
                                        ],
                                        gameType: 'basic'
                                    };
                                    
                                    log('Game options: ' + JSON.stringify(options, (key, value) => {
                                        if (key === 'container') return '[HTMLElement]';
                                        return value;
                                    }, 2));
                                    
                                    const gamePromise = window.mk.start(options);
                                    log('Game promise type: ' + typeof gamePromise);
                                    
                                    if (gamePromise) {
                                        log('Game promise methods: ' + Object.getOwnPropertyNames(gamePromise.__proto__).join(', '));
                                        
                                        if (gamePromise.ready && typeof gamePromise.ready === 'function') {
                                            log('‚úÖ Game promise has ready method');
                                            gamePromise.ready(() => {
                                                log('üéâ Game is ready!');
                                                const children = arenaEl.children.length;
                                                log(`Arena has ${children} children after ready callback`);
                                            });
                                        } else {
                                            log('‚ùå Game promise has no ready method');
                                        }
                                    } else {
                                        log('‚ùå Game promise is null/undefined');
                                    }
                                    
                                    // –ß–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –ø—Ä–æ–≤–µ—Ä–∏–º –∫–æ–Ω—Ç–µ–Ω—Ç
                                    [1, 2, 3, 5].forEach(seconds => {
                                        setTimeout(() => {
                                            const children = arenaEl.children.length;
                                            log(`After ${seconds}s: Arena has ${children} children`);
                                            if (children > 0 && seconds === 1) {
                                                log('‚úÖ Game seems to be loaded');
                                                // –ü—Ä–æ–≤–µ—Ä–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–µ—Ä–≤–æ–≥–æ child
                                                const firstChild = arenaEl.children[0];
                                                if (firstChild) {
                                                    log(`First child: ${firstChild.tagName} with ${firstChild.children.length} children`);
                                                }
                                            }
                                        }, seconds * 1000);
                                    });
                                    
                                } catch (error) {
                                    log('‚ùå Error starting game: ' + error.message);
                                    log('Error stack: ' + error.stack);
                                    console.error(error);
                                }
                            } else {
                                log('‚ùå mk.arenas.types not available');
                                log('mk.arenas: ' + Object.keys(window.mk.arenas).join(', '));
                            }
                        } else {
                            log('‚ùå mk.arenas not available');
                            log('mk keys: ' + Object.keys(window.mk).join(', '));
                        }
                    } else {
                        log('‚ùå window.mk not available');
                        log('window.mk: ' + typeof window.mk);
                    }
                }, 500);
            };
            mk.onerror = (error) => {
                log('‚ùå Error loading mk.js: ' + error);
            };
            document.head.appendChild(mk);
        };
        movement.onerror = (error) => {
            log('‚ùå Error loading movement.js: ' + error);
        };
        document.head.appendChild(movement);
    </script>
</body>
</html> 