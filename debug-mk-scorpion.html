<!DOCTYPE html>
<html>
<head>
    <title>Debug MK.js - Scorpion Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #222;
            color: white;
            font-family: Arial, sans-serif;
        }
        #arena {
            border: 4px solid #fbbf24;
            width: 800px;
            height: 400px;
            background: black;
            margin: 20px auto;
        }
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            background: #fbbf24;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            color: black;
        }
        button:hover { background: #f59e0b; }
        .log {
            background: #333;
            padding: 15px;
            margin: 20px auto;
            max-width: 800px;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #3b82f6; }
    </style>
</head>
<body>
    <h1>ü¶Ç MK.js Scorpion Debug Test</h1>
    
    <div class="controls">
        <button onclick="testScorpionVsSubzero()">ü¶Ç vs ‚ùÑÔ∏è Scorpion vs Sub-Zero</button>
        <button onclick="testScorpionVsKano()">ü¶Ç vs üëπ Scorpion vs Kano</button>
        <button onclick="testTwoScorpions()">ü¶Ç vs ü¶Ç Two Scorpions</button>
        <button onclick="clearArena()">üßπ Clear Arena</button>
    </div>

    <div id="arena"></div>
    
    <div class="log" id="log"></div>
    
    <script src="/mk.js/game/src/movement.js"></script>
    <script src="/mk.js/game/src/mk.js"></script>
    
    <script>
        let currentGame = null;
        
        function log(message, type = 'info') {
            const logEl = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const className = type;
            logEl.innerHTML += `<div class="${className}">[${time}] ${message}</div>`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function clearArena() {
            const arena = document.getElementById('arena');
            arena.innerHTML = '';
            if (currentGame && window.mk && window.mk.reset) {
                try {
                    window.mk.reset();
                    log('Arena cleared and game reset', 'success');
                } catch (e) {
                    log('Error during reset: ' + e.message, 'error');
                }
            }
            currentGame = null;
        }
        
        function checkMkJs() {
            if (typeof window.mk === 'undefined') {
                log('‚ùå mk.js not loaded', 'error');
                return false;
            }
            
            if (!window.mk.fighters || !window.mk.fighters.list) {
                log('‚ùå mk.fighters.list not available', 'error');
                return false;
            }
            
            if (!window.mk.fighters.list.scorpion) {
                log('‚ùå Scorpion not found in fighters list', 'error');
                log('Available fighters: ' + Object.keys(window.mk.fighters.list).join(', '), 'info');
                return false;
            }
            
            log('‚úÖ mk.js loaded and Scorpion available', 'success');
            return true;
        }
        
        function startGame(fighter1, fighter2, testName) {
            log(`üéÆ Starting test: ${testName}`, 'info');
            
            if (!checkMkJs()) {
                return;
            }
            
            clearArena();
            
            // Configure mk.js
            if (window.mk.config) {
                window.mk.config.IMAGES = '/mk.js/game/images/';
                window.mk.config.STEP_DURATION = 120;
                log('üñºÔ∏è Configured image paths and step duration', 'info');
            }
            
            const arena = document.getElementById('arena');
            
            try {
                const options = {
                    arena: {
                        container: arena,
                        arena: window.mk.arenas.types.THRONE_ROOM,
                        width: 800,
                        height: 400
                    },
                    fighters: [
                        { name: fighter1 },
                        { name: fighter2 }
                    ],
                    gameType: 'multiplayer',
                    callbacks: {
                        attack: (attacker, defender, damage) => {
                            log(`‚öîÔ∏è ${attacker.getName()} attacked ${defender.getName()} for ${damage} damage`, 'warning');
                        },
                        'game-end': (loser) => {
                            const winner = currentGame.fighters.find(f => f !== loser);
                            log(`üèÜ Game Over! ${winner.getName()} defeated ${loser.getName()}!`, 'success');
                        }
                    }
                };
                
                log(`üöÄ Starting game: ${fighter1} vs ${fighter2}`, 'info');
                
                const gamePromise = window.mk.start(options);
                
                if (gamePromise && gamePromise.ready) {
                    gamePromise.ready(() => {
                        log('üéâ Game ready! Fight!', 'success');
                        currentGame = gamePromise;
                        
                        // Check if Scorpion sprites loaded correctly
                        if (fighter1.toLowerCase() === 'scorpion' || fighter2.toLowerCase() === 'scorpion') {
                            setTimeout(() => {
                                checkScorpionSprites();
                            }, 1000);
                        }
                    });
                } else {
                    log('‚ö†Ô∏è No ready callback available', 'warning');
                    currentGame = gamePromise;
                }
                
                // Fallback check
                setTimeout(() => {
                    const children = arena.children.length;
                    if (children > 0) {
                        log(`‚úÖ Game loaded successfully (${children} elements in arena)`, 'success');
                        if (!currentGame) currentGame = gamePromise;
                    } else {
                        log('‚ùå Game failed to load - arena is empty', 'error');
                    }
                }, 3000);
                
            } catch (error) {
                log('‚ùå Error starting game: ' + error.message, 'error');
                console.error(error);
            }
        }
        
        function checkScorpionSprites() {
            log('üîç Checking Scorpion sprites...', 'info');
            
            if (!currentGame || !currentGame.fighters) {
                log('‚ùå No active game to check', 'error');
                return;
            }
            
            const scorpion = currentGame.fighters.find(f => 
                f.getName().toLowerCase().includes('scorpion')
            );
            
            if (!scorpion) {
                log('‚ùå Scorpion fighter not found in game', 'error');
                return;
            }
            
            log(`‚úÖ Found Scorpion fighter: ${scorpion.getName()}`, 'success');
            
            // Check if Scorpion has proper animations
            if (scorpion.moves) {
                const moves = Object.keys(scorpion.moves);
                log(`üé≠ Scorpion has ${moves.length} moves: ${moves.join(', ')}`, 'info');
                
                // Check specific moves
                const requiredMoves = ['stand', 'walking', 'high-kick', 'low-kick', 'high-punch', 'low-punch'];
                const missingMoves = requiredMoves.filter(move => !scorpion.moves[move]);
                
                if (missingMoves.length === 0) {
                    log('‚úÖ All required Scorpion moves are available', 'success');
                } else {
                    log(`‚ùå Missing moves: ${missingMoves.join(', ')}`, 'error');
                }
            }
            
            // Check current state/sprite
            if (scorpion.getState && scorpion.getState()) {
                log('‚úÖ Scorpion sprite is loaded and active', 'success');
            } else {
                log('‚ùå Scorpion sprite not properly loaded', 'error');
            }
        }
        
        function testScorpionVsSubzero() {
            startGame('scorpion', 'subzero', 'Scorpion vs Sub-Zero');
        }
        
        function testScorpionVsKano() {
            startGame('scorpion', 'kano', 'Scorpion vs Kano');
        }
        
        function testTwoScorpions() {
            startGame('scorpion', 'scorpion', 'Two Scorpions');
        }
        
        // Initialize on page load
        window.onload = function() {
            log('üìÑ Page loaded', 'info');
            
            // Wait a bit for scripts to load
            setTimeout(() => {
                if (checkMkJs()) {
                    log('üéØ Ready to test! Click a button above to start.', 'success');
                } else {
                    log('‚ùå mk.js initialization failed', 'error');
                }
            }, 500);
        };
        
        // Add keyboard controls info
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('üïπÔ∏è Controls:', 'info');
                log('Player 1: WASD + Q/E (punch) + Z/X (kick) + Shift (block)', 'info');
                log('Player 2: Arrow keys + O/P (punch) + ,/. (kick) + / (block)', 'info');
            }, 1000);
        });
    </script>
</body>
</html> 